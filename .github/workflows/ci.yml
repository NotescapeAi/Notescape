# .github/workflows/ci.yml
name: CI
on: [push, pull_request]

permissions:
  contents: read

jobs:
  frontend:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: frontend
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: npm
          cache-dependency-path: frontend/package-lock.json
      - run: node -v   
      - run: npm ci
      - run: npm run lint
      - run: npm test
      - run: npm run build
        env:
          
          VITE_EMAILJS_PUBLIC_KEY: ${{ secrets.VITE_EMAILJS_PUBLIC_KEY || 'dummy' }}
          VITE_EMAILJS_SERVICE_ID: ${{ secrets.VITE_EMAILJS_SERVICE_ID || 'dummy' }}
          VITE_EMAILJS_TEMPLATE_ID: ${{ secrets.VITE_EMAILJS_TEMPLATE_ID || 'dummy' }}
      
  backend:
      runs-on: ubuntu-latest
      defaults:
        run:
          working-directory: backend
      env:
        PYTHONPATH: ${{ github.workspace }}/backend
      steps:
        - uses: actions/checkout@v4
        - uses: actions/setup-python@v5
          with:
            python-version: "3.11"
            cache: "pip"
        - run: python -m pip install -U pip
        - run: pip install -r requirements.txt
        - run: pip install pytest ruff
        - run: ruff check .
        - run: pytest -q
